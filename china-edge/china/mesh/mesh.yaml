defaultRegistry: crpi-ynub1f3ynqwgpy46.cn-hangzhou.personal.cr.aliyuncs.com/streamx-demo
defaultImageTag: 2.0.0-jvm

sources:

ingestion:

processing:

delivery:
  blueprint-search:
    image: opensearch-delivery-service
    incoming:
      indexable-resources:
        topic: outboxes/indexable-resources
      indexable-resource-fragments:
        topic: outboxes/indexable-resource-fragments
    port: 8082
    volumesFrom:
      configs:
        - "opensearch/service-init:/deployments/opensearch/service-init"
    environment:
      QUARKUS_ELASTICSEARCH_USERNAME: "admin"
      QUARKUS_ELASTICSEARCH_HOSTS: "blueprint-search.opensearch:9201"
      STREAMX_BLUEPRINTS_OPENSEARCH-DELIVERY-SERVICE_MIGRATION-SCRIPT-LOCATIONS: "classpath:opensearch/service-init,file:opensearch/service-init"
    environmentFrom:
      secrets:
        - "opensearch-secrets.properties"
    components:
      opensearch:
        image: "opensearch:2.16.0"
        ports:
          - 9201:9201
        environment:
          network.host: "0.0.0.0"
          http.port: "9201"
          discovery.type: "single-node"
          DISABLE_SECURITY_PLUGIN: "true"
        environmentFrom:
          secrets:
            - "opensearch-component-secrets.properties"
  blueprint-web:
    image: web-delivery-service
    incoming:
      pages:
        topic: outboxes/pages
      fragments:
        topic: outboxes/fragments
      assets:
        topic: outboxes/assets
      web-resources:
        topic: outboxes/web-resources
    environment:
      STREAMX_BLUEPRINTS_WEB-DELIVERY-SERVICE_RESOURCES_DIRECTORY: "/srv/www"
    repositoryVolume: "/srv/www"
    port: 8083
    components:
      webserver:
        image: "nginx:1.26.0"
        ports:
          - 8084:80
        repositoryVolume: "/usr/share/nginx/html"
        volumesFrom:
          configs:
            - "nginx_conf/demo.conf:/etc/nginx/conf.d/default.conf"